---
# Configure GNOME keyboard shortcuts and keybindings

- name: Set custom keyboard shortcuts
  dconf:
    key: "/org/gnome/settings-daemon/plugins/media-keys/{{ item.key }}"
    value: "{{ item.value }}"
  environment:
    DBUS_SESSION_BUS_ADDRESS: "{{ dbus_session_bus_address }}"
  loop: "{{ keyboard_shortcuts }}"
  when: keyboard_shortcuts is defined
  tags: ['gnome-keybindings']

- name: Set window management keybindings
  dconf:
    key: "/org/gnome/desktop/wm/keybindings/{{ item.key }}"
    value: "{{ item.value }}"
  environment:
    DBUS_SESSION_BUS_ADDRESS: "{{ dbus_session_bus_address }}"
  loop: "{{ wm_keybindings }}"
  when: wm_keybindings is defined
  tags: ['gnome-keybindings']

- name: Set shell keybindings
  dconf:
    key: "/org/gnome/shell/keybindings/{{ item.key }}"
    value: "{{ item.value }}"
  environment:
    DBUS_SESSION_BUS_ADDRESS: "{{ dbus_session_bus_address }}"
  loop: "{{ shell_keybindings }}"
  when: shell_keybindings is defined
  tags: ['gnome-keybindings']

- name: Set mutter keybindings
  dconf:
    key: "/org/gnome/mutter/keybindings/{{ item.key }}"
    value: "{{ item.value }}"
  environment:
    DBUS_SESSION_BUS_ADDRESS: "{{ dbus_session_bus_address }}"
  loop: "{{ mutter_keybindings | default([]) }}"
  when: mutter_keybindings is defined
  tags: ['gnome-keybindings']

- name: Set mutter wayland keybindings
  dconf:
    key: "/org/gnome/mutter/wayland/keybindings/{{ item.key }}"
    value: "{{ item.value }}"
  environment:
    DBUS_SESSION_BUS_ADDRESS: "{{ dbus_session_bus_address }}"
  loop: "{{ mutter_wayland_keybindings | default([]) }}"
  when: mutter_wayland_keybindings is defined
  tags: ['gnome-keybindings']

- name: Clear existing custom keybindings
  dconf:
    key: "/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings"
    value: "[]"
  environment:
    DBUS_SESSION_BUS_ADDRESS: "{{ dbus_session_bus_address }}"
  when: custom_keybindings is defined
  tags: ['gnome-keybindings']

- name: Set custom keybindings paths
  dconf:
    key: "/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings"
    value: "{{ custom_keybindings | map(attribute='path') | list | string }}"
  environment:
    DBUS_SESSION_BUS_ADDRESS: "{{ dbus_session_bus_address }}"
  when: custom_keybindings is defined
  tags: ['gnome-keybindings']

- name: Configure each custom keybinding
  dconf:
    key: "/org/gnome/settings-daemon/plugins/media-keys/custom-keybindings/{{ item.name }}/{{ item.property }}"
    value: "{{ item.value }}"
  environment:
    DBUS_SESSION_BUS_ADDRESS: "{{ dbus_session_bus_address }}"
  loop: "{{ custom_keybindings_details }}"
  when: custom_keybindings_details is defined
  tags: ['gnome-keybindings']
